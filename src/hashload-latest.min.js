(function(e){if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]===a)return c;return-1};var g=function(){};g.prototype={constructor:g,addEvent:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,b,c,d){a.removeEventListener&&a.removeEventListener(b,c,d||!1)},triggerEvent:function(a,b,c,d){a=this.createEvent(a,b,c,d);document.createEvent?b.dispatchEvent(a):
(b.fireEvent?b:document).fireEvent(a.eventType,a)},createEvent:function(a,b,c,d){var f,b=b||e,c=c||!1,d=d||!1;document.createEvent?(f=document.createEvent("HTMLEvents"),f.initEvent(a,c,d)):(f=document.createEventObject(),f.eventType="on"+a);f.target=b;return f}};var h=function(a,b,c,d,f){if(!a||!a instanceof RegExp&&typeof a!="string")throw Error("Pattern has to be either a RegExp object or a string");if(b&&typeof b!="function")throw Error("Callback should be either null or function");if(c&&typeof c!=
"string")throw Error("URL parameter has to be a string");if(c&&typeof jQuery=="undefined")throw console.log("there"),Error("Hashload currently requires jQuery to process AJAX calls");if(d&&typeof d!="string"||d&&-1==["get","post"].indexOf(d.toLowerCase()))throw Error("Only the following methods are supported: get, post - and the method should be passed as a string");if(f&&typeof f!="object")throw Error("Params can either be null or an object");this.pattern=typeof a=="string"?RegExp(a):a;this.callback=
b||function(){};this.url=c;this.method=d||"get";this.params=f||{};this.errorCallback=function(){e.location=this.url};this.completeCallback=function(){}};h.prototype={constructor:h,match:function(a){return this.pattern.test(a.hash)},makeCall:function(a){if(this.url){var b=this;this.params=a.params?a.params:this.params;jQuery.ajax({url:this.url,data:this.params,success:function(a,d,f){b.callback.apply(this,arguments)},error:function(a,d,f){b.errorCallback.apply(this,arguments)},complete:function(a,
d){b.completeCallback.apply(this,arguments)},type:this.method})}else this.callback(a)},setErrorCallback:function(a){this._validateCallback(a);this.errorCallback=a},setCompleteCallback:function(a){this._validateCallback(a);this.completeCallback=a},_validateCallback:function(a){if(!a||typeof a!="function")throw Error("Callback has to be a function");}};var i=function(){this.callDefaultHandler=!0;this.skipDefaultHandler=!1;this.resetDefaultHandler();this.resetPreDispatchCallback();this.hash=null;this._rules=
[];this._patterns=[];this._eventManager=new g};i.prototype={constructor:i,onHashChange:function(a){a.hash=e.location.hash.substr(1);var b=this.preDispatchCallback(a);if(this._supportsHashChange())for(var c in b)a[c]=b[c];this.dispatchEvent(a);this.processDefaultHandler(a)},run:function(){this.init()},init:function(){var a=this;this._supportsHashChange()?this._eventManager.addEvent(e,"hashchange",function(b){a.onHashChange(a,b)}):this._legacyPoll();e.location.hash&&this.triggerHashChange()},dispatchEvent:function(a){var b,
c=this._rules.length;for(b=0;b<c;b++){var d=this._rules[b];d&&d instanceof h&&d.match(a)&&d.makeCall(a)}},addRule:function(a,b,c,d,f){this._rules.push(new h(a,b,c,d,f));this._patterns.push(a)},removeRule:function(a){this._validatePattern(a);for(var a=typeof a=="string"?RegExp(a):a,b=this._patterns.indexOf(a);-1!=b;)delete this._patterns[b],delete this._rules[b],b=this._patterns.indexOf(a)},replaceRule:function(a,b,c,d,f){this._validatePattern(a);this._validateCallback(b);var a=typeof a=="string"?
RegExp(a):a,e,g=this._rules.length;for(e=0;e<g;e++)a==this._patterns[e]&&(this._rules[e]=new h(a,b,c,d,f))},hasRule:function(a){this._validatePattern(a);return-1!=this._patterns.indexOf(typeof a=="string"?RegExp(a):a)},setDefaultHandler:function(a){this.defaultHandler=function(b){a.call(this,b)}},resetDefaultHandler:function(){this.defaultHandler=function(){}},setCallDefaultHeader:function(a){this.callDefaultHeader=a},skipDefaultHandler:function(){this.skipDefaultHandler=!0},setPreDispatchCallback:function(a){this.preDispatchCallback=
function(b){return a.call(this,b)}},resetPreDispatchCallback:function(){this.preDispatchCallback=function(a){return a}},processDefaultHandler:function(a){this.callDefaultHandler&&!this.skipDefaultHandler&&this.defaultHandler(a);this.skipDefaultHandler=!1},triggerHashChange:function(){if(this._supportsHashChange())this._eventManager.triggerEvent("hashchange",e);else this.onHashChange(this._eventManager.createEvent("hashchange",e))},_validatePattern:function(a){if(!a||typeof a!="string"&&!a instanceof
RegExp)throw Error("Pattern has to be either an instance of the RegExp object or a string");},_validateCallback:function(a){if(a&&typeof a!="function")throw Error("Callback cannot be null and has to be a function");},_supportsHashChange:function(){return"onhashchange"in e&&(document.documentMode===void 0||document.documentMode>7)},_legacyPoll:function(){var a=this;this.hash=e.location.hash;e.setInterval(function(){if(a.hash!=e.location.hash)a.hash=e.location.hash,a.triggerHashChange()},300)}};e.hl=
e.hashload=e.Hashload=new i})(window);